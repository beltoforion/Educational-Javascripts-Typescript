!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.TidalSimulationLibrary=i():t.TidalSimulationLibrary=i()}(this,(()=>(()=>{"use strict";var t={d:(i,s)=>{for(var e in s)t.o(s,e)&&!t.o(i,e)&&Object.defineProperty(i,e,{enumerable:!0,get:s[e]})},o:(t,i)=>Object.prototype.hasOwnProperty.call(t,i),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},i={};t.r(i),t.d(i,{createTidalSimulation:()=>a,tides:()=>o});class s{constructor(t,i){this.x=t,this.y=i}clone(){return new s(this.x,this.y)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSqr(){return this.x*this.x+this.y*this.y}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}rotate(t){var i=t*Math.PI/180;return this.x=this.x*Math.cos(i)-this.y*Math.sin(i),this.y=this.x*Math.sin(i)+this.y*Math.cos(i),this}orthoNormal(){var t=new s(this.y,this.x);return t.multiplyValue(t.length())}verticalAngle(){return Math.PI-Math.atan2(this.x,this.y)}verticalAngleDeg(){return 180*this.verticalAngle()/Math.PI}addXY(t,i){return this.x+=t,this.y+=i,this}normalize(){var t=this.length();return this.divideValue(t),this}multiplyValue(t){return this.x*=t,this.y*=t,this}divideValue(t){return this.x/=t,this.y/=t,this}rotateEx(t){var i=t*Math.PI/180;return new s(this.x*Math.cos(i)-this.y*Math.sin(i),this.x*Math.sin(i)+this.y*Math.cos(i))}static subtractEx(t,i){return new s(t.x-i.x,t.y-i.y)}static addEx(t,i){return new s(t.x+i.x,t.y+i.y)}}class e{static Create(t){var i=t.getContext("2d");return i.drawVector=function(t,i,s,e,h,o,a){var l=t,r=i,n=l+s,c=r+e,u=Math.atan2(c-r,n-l);this.beginPath(),this.moveTo(l,r),this.lineTo(n,c),this.lineTo(n-h*Math.cos(u-Math.PI/6),c-h*Math.sin(u-Math.PI/7)),this.moveTo(n,c),this.lineTo(n-h*Math.cos(u+Math.PI/6),c-h*Math.sin(u+Math.PI/7)),this.lineWidth=null!=o?o:2,this.strokeStyle=null!=a?a:"yellow",this.stroke(),this.closePath()},i.drawArrow=function(t,i,s,e,h,o,a){var l=Math.atan2(e-i,s-t);this.beginPath(),this.moveTo(t,i),this.lineTo(s,e),this.lineTo(s-h*Math.cos(l-Math.PI/6),e-h*Math.sin(l-Math.PI/7)),this.moveTo(s,e),this.lineTo(s-h*Math.cos(l+Math.PI/6),e-h*Math.sin(l+Math.PI/7)),this.lineWidth=null!=o?o:2,this.strokeStyle=null!=a?a:"yellow",this.stroke(),this.closePath()},i.drawCross=function(t,i,s,e,h){this.beginPath(),this.moveTo(t-e,i),this.lineTo(t+e,i),this.moveTo(t,i-e),this.lineTo(t,i+e),this.strokeStyle=h,this.lineWidth=s,this.stroke(),this.closePath()},i.drawCircle=function(t,i,s,e,h,o,a){this.beginPath(),this.arc(t.x,t.y,i,s,e),null!=h&&(this.fillStyle=h,this.fill()),this.lineWidth=null!=a?a:2,this.strokeStyle=o,this.stroke(),this.closePath()},i.drawCenterOfMass=function(t,i){this.fillStyle="white",this.beginPath(),this.arc(t.x,t.y,i,0,Math.PI/2),this.lineTo(t.x,t.y),this.closePath(),this.fill(),this.fillStyle="black",this.beginPath(),this.arc(t.x,t.y,i,Math.PI/2,Math.PI),this.lineTo(t.x,t.y),this.closePath(),this.fill(),this.fillStyle="white",this.beginPath(),this.arc(t.x,t.y,i,Math.PI,1.5*Math.PI),this.lineTo(t.x,t.y),this.closePath(),this.fill(),this.fillStyle="black",this.beginPath(),this.arc(t.x,t.y,i,1.5*Math.PI,2*Math.PI),this.lineTo(t.x,t.y),this.closePath(),this.fill()},i}}class h{constructor(t){this.distCenterOfMass=0,this.forceMultiplier=0,this.accMultiplier=0,this.ts=0,this.scaleSize=0,this.scaleDist=0,this.scaleContext=0,this.dragMoon=!1,this.dragDropImage=new Image,this.continentsImage=new Image,this.moonImage=new Image,this.bckgImage=new Image,this.config=t,this.canvas=document.getElementById(t.cvid),this.ctx=e.Create(this.canvas),this.w=this.canvas.width,this.h=this.canvas.height,this.lookAt=new s(0,0),this.numArrows=30,this.time=0,this.gamma=667408e-16,this.distMoonEarth=3844e5,this.distEarthSun=149597870700,this.vecEarthSun=new s(0,0),this.vecEarthMoon=new s(0,0),this.vecCenterOfMass=new s(0,0),0==t.setup?(this.forceMultiplier=1500,this.accMultiplier=1200,this.ts=2,this.scaleSize=2e-5,this.scaleDist=this.scaleSize,this.earth={pos:new s(-9e6,0),m:59721986e17,r:6367500,p:31558118.4,tidalForce:[this.numArrows+1],tidalForceSun:[this.numArrows+1]},this.moon={pos:new s(7e6,0),m:7349e19,r:1738e3,p:2360620.8},this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this),!1),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this),!1),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this),!1)):1==t.setup&&(this.setScaleForceToModel(t.scaleForceToModel),this.ts=t.timestep,this.scaleDist=65e-8,this.scaleSize=11e-6,this.scaleContext=this.scaleSize,this.earth={pos:new s(0,0),m:59721986e17,r:6367500,p:31558118.4,tidalForce:[this.numArrows+1],tidalForceSun:[this.numArrows+1]},this.moon={pos:new s(0,0),m:7349e19,r:1738e3,p:2360620.8},this.distCenterOfMass=this.distMoonEarth*this.moon.m/(this.moon.m+this.earth.m)),this.sun={pos:new s(0,0),m:1.98855e30,r:696342e3},this.style={colBack:"#112255",colEarth:"rgb(30,130,220)",colEarthDark:"rgba(0, 0, 0, 0.7)",colEarthOutline:"darkGrey",colMoon:"white",colMoonDark:"rgba(0, 0, 0, 0.7)",colMoonOutline:"rgba(0, 0, 0, 0)",colVec1:"rgba(255, 255, 255, 0.4)",colVec2:"rgba(255, 128, 128, 0.4)",colVec3:"#ffffff",colVec4:"rgba(255, 165, 0, 0.8)",colWater:"rgba(30, 130, 220, 0.6)",colOrbit:"rgba(255, 165, 0, 0.5)",colOrigin:"yellow",colCenterOfEarth:"rgba(255, 165, 0,   1)",colSun:"rgba(255, 235, 50, 0.5)"},this.dragDropImage.src=this.config.path+"/images/dragdrop.png",this.continentsImage.src=this.config.path+"/images/continents.png",this.moonImage.src=this.config.path+"/images/moon.png",this.bckgImage.src=this.config.path+"/images/milkyway.jpg",this.init(t)}init(t){t.isRunning?window.setInterval(this.tick.bind(this),30):this.tick()}tick(){this.update(),this.render()}getMousePos(t){let i=this.canvas.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}}onMouseDown(t){if(0!=this.config.setup)return;let i=this.getMousePos(t),e=new s(0,0);e.x=i.x-this.lookAt.x*this.scaleDist-this.w/2,e.y=i.y-this.lookAt.y*this.scaleDist-this.h/2,e.divideValue(this.scaleDist);let h=s.subtractEx(this.moon.pos,e).length();this.dragMoon=h<this.moon.r}onMouseUp(t){0==this.config.setup&&(this.dragMoon=!1)}onMouseMove(t){if(0!=this.config.setup)return;let i=this.getMousePos(t);if(null==this.dragMoon||!this.dragMoon)return;let e=i.x-this.lookAt.x*this.scaleDist-this.w/2,h=i.y-this.lookAt.y*this.scaleDist-this.h/2;e/=this.scaleDist,h/=this.scaleDist;let o=new s(e,h),a=s.subtractEx(o,this.earth.pos);s.subtractEx(this.earth.pos,o).length()>2*this.earth.r?this.moon.pos=new s(e,h):(this.moon.pos=this.earth.pos.clone(),this.moon.pos.add(a.normalize().multiplyValue(2*this.earth.r)))}setScaleForceToModel(t){this.config.scaleForceToModel=t,t?(this.accMultiplier=17e5,this.forceMultiplier=this.accMultiplier):(this.accMultiplier=17e5,this.forceMultiplier=10*this.accMultiplier)}addBackground(){let t=this.bckgImage,i=this.ctx,s=i.canvas.width,e=i.canvas.height,h=.5,o=.5;h<0&&(h=0),o<0&&(o=0),h>1&&(h=1),o>1&&(o=1);let a,l,r,n,c=t.width,u=t.height,d=Math.min(s/c,e/u),m=c*d,y=u*d,x=1;m<s&&(x=s/m),y<e&&(x=e/y),m*=x,y*=x,r=c/(m/s),n=u/(y/e),a=(c-r)*h,l=(u-n)*o,a<0&&(a=0),l<0&&(l=0),r>c&&(r=c),n>u&&(n=u),i.drawImage(t,a,l,r,n,0,0,s,e)}resizeToCanvas(){this.w=this.canvas.width,this.h=this.canvas.height}mapToScreen(t,i){let s=t.clone();return s.subtract(this.lookAt),null==i&&(i=this.scaleDist),s.multiplyValue(i),s.addXY(this.w/2,this.h/2),s}setPositions(t,i){this.earth.pos.x=-Math.sin(i)*this.distCenterOfMass,this.earth.pos.y=-Math.cos(i)*this.distCenterOfMass,this.moon.pos.x=Math.sin(i)*(this.distMoonEarth-this.distCenterOfMass),this.moon.pos.y=Math.cos(i)*(this.distMoonEarth-this.distCenterOfMass),this.sun.pos.x=this.earth.pos.x+Math.sin(t)*this.distEarthSun,this.sun.pos.y=this.earth.pos.y+Math.cos(t)*this.distEarthSun}move(){if(this.config.autoMove){let t=2*this.time*Math.PI/this.moon.p,i=2*this.time*Math.PI/this.earth.p;this.setPositions(i,t),this.time+=this.ts}this.vecEarthMoon=s.subtractEx(this.moon.pos,this.earth.pos),this.vecEarthSun=s.subtractEx(this.sun.pos,this.earth.pos);let t=this.earth.pos.clone().multiplyValue(this.earth.m),i=this.moon.pos.clone().multiplyValue(this.moon.m);this.vecCenterOfMass=s.addEx(t,i).divideValue(this.earth.m+this.moon.m),"Earth"===this.config.lookAtTarget?this.lookAt=this.earth.pos.clone():this.lookAt=new s(0,0)}update(){this.move();let t=2*Math.PI/this.numArrows;if(null!=this.config.scaleForceToModel&&this.config.scaleForceToModel)i=this.scaleSize,h=(e=this.scaleDist)*e,o=60;else var i=1,e=1,h=1,o=0;let a=this.vecEarthMoon.clone();a.normalize(),a.multiplyValue(this.gamma*this.moon.m/Math.pow(o+this.vecEarthMoon.length()*e,2)),this.earth.tidalForce[0]=a.multiplyValue(h);let l=this.vecEarthSun.clone();l.normalize(),l.multiplyValue(this.gamma*this.sun.m/Math.pow(o+this.vecEarthSun.length()*e,2)),this.earth.tidalForceSun[0]=l.multiplyValue(h);for(let a=1;a<this.numArrows+1;++a){let l=new s(Math.sin(a*t)*this.earth.r*i,Math.cos(a*t)*this.earth.r*i),r=this.vecEarthMoon.clone();r.multiplyValue(e);let n=s.subtractEx(r,l);n.normalize();let c=s.subtractEx(r,l).length()+o;n.multiplyValue(this.gamma*this.moon.m/(c*c)),this.earth.tidalForce[a]=n.multiplyValue(h);let u=this.vecEarthSun.clone();u.multiplyValue(e);let d=s.subtractEx(u,l);d.normalize(),c=s.subtractEx(u,l).length()+o,d.multiplyValue(this.gamma*this.sun.m/(c*c)),this.earth.tidalForceSun[a]=d.multiplyValue(h)}}renderSun(){let t=this.mapToScreen(this.lookAt),i=this.mapToScreen(this.sun.pos,this.scaleDist),e=(this.mapToScreen(this.earth.pos,this.scaleDist),i.clone().subtract(t).normalize()),h=new s(e.y,-e.x).multiplyValue(this.earth.r*this.scaleSize),o=e.multiplyValue(this.earth.r*this.scaleSize*-1);for(let s=0;s<10;++s)this.ctx.drawArrow(i.x,i.y,t.x+s*h.x-o.x,t.y+s*h.y-o.y,10,2,this.style.colSun),s>0&&this.ctx.drawArrow(i.x,i.y,t.x-s*h.x-o.x,t.y-s*h.y-o.y,10,2,this.style.colSun)}renderMoon(){let t=this.moon.pos.clone();t=this.mapToScreen(t,this.scaleDist);let i=this.moon.r*this.scaleSize;if(0==this.config.setup&&this.vecEarthMoon.length()>1e8){let t=this.mapToScreen(this.earth.pos.clone(),this.scaleDist),i=this.vecEarthMoon.normalize().multiplyValue(100);this.ctx.drawVector(t.x+3*i.x,t.y+3*i.y,i.x,i.y,30,2,this.style.colMoon),this.ctx.font="20px Arial",this.ctx.fillStyle="White",this.ctx.fillText("Moon (385000 km)",t.x+3*i.x-40,t.y+3*i.y+40)}else{let s=this.style.colMoonOutline,e=2;if(1!=this.config.setup){let t=Math.round(128+128*Math.sin(.15*this.time));s="rgb("+t+","+t+","+t+")",e=4}if(this.ctx.drawCircle(t,i,0,2*Math.PI,this.style.colMoon,s,e),this.config.enableRotation?(this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(-this.time*Math.PI*2/this.moon.p+Math.PI),this.ctx.drawImage(this.moonImage,-i,-i,2*i,2*i),this.ctx.restore()):this.ctx.drawImage(this.moonImage,t.x-i,t.y-i,2*i,2*i),this.config.showSun){let s=this.vecEarthSun.verticalAngle(),e=s+Math.PI;this.ctx.drawCircle(t,i,s,e,this.style.colMoonDark,this.style.colMoonOutline)}0==this.config.setup&&this.ctx.drawImage(this.dragDropImage,t.x-i,t.y-i,2*i,2*i);let h=this.moon.r*this.scaleSize;this.ctx.font="20px Arial",this.ctx.fillStyle="White",this.ctx.fillText("Moon",t.x-24,t.y+h+25)}}renderEarth(){let t=this.accMultiplier,i=this.forceMultiplier,e=this.mapToScreen(this.earth.pos,this.scaleSize),h=this.earth.r*this.scaleSize;if(this.ctx.drawCircle(e,h,0,2*Math.PI,this.style.colEarth,this.style.colEarthOutline),this.config.enableRotation?(this.ctx.save(),this.ctx.translate(e.x,e.y),this.ctx.rotate(-this.time*Math.PI*2/86400),this.ctx.drawImage(this.continentsImage,-h,-h,2*h,2*h),this.ctx.restore()):this.ctx.drawImage(this.continentsImage,e.x-h,e.y-h,2*h,2*h),this.config.showSun){let t=this.vecEarthSun.verticalAngle(),i=t+Math.PI;this.ctx.drawCircle(e,h,t,i,this.style.colEarthDark,this.style.colEarthOutline)}let o=this.earth.tidalForce[0].clone(),a=this.earth.tidalForceSun[0].clone();if(this.config.showGravAcc||this.config.showCentAcc||this.config.showTidalAcc||this.config.showTidalAccSun||this.config.showAccSum){let h=[this.numArrows+1],l=2*Math.PI/this.numArrows;for(let r=1;r<this.numArrows+1;++r){let n=s.addEx(e,new s(Math.sin(r*l)*this.earth.r*this.scaleSize,Math.cos(r*l)*this.earth.r*this.scaleSize)),c=this.earth.tidalForce[r];this.config.showGravAcc&&this.ctx.drawVector(n.x,n.y,c.x*t,c.y*t,5,2,this.style.colVec1),this.config.showCentAcc&&this.ctx.drawVector(n.x,n.y,-o.x*t,-o.y*t,5,2,this.style.colVec2);let u=s.subtractEx(c,o);this.config.showTidalAcc&&this.ctx.drawVector(n.x,n.y,u.x*i,u.y*i,4,3,this.style.colVec3);let d=s.subtractEx(this.earth.tidalForceSun[r],a);this.config.showTidalAccSun&&this.ctx.drawVector(n.x,n.y,d.x*i,d.y*i,4,3,this.style.colVec4),h[r]={x:n.x+i*(u.x+d.x),y:n.y+i*(u.y+d.y)}}if(this.config.showAccSum){this.ctx.fillStyle=this.style.colWater,this.ctx.beginPath(),this.ctx.moveTo(h[0].x,h[0].y);for(let t=1;t<this.numArrows+1;++t)this.ctx.lineTo(h[t].x,h[t].y);this.ctx.closePath(),this.ctx.fill()}this.config.showGravAcc&&this.ctx.drawVector(e.x,e.y,o.x*t,o.y*t,5,4,this.style.colVec1)}this.config.showCentAcc&&this.ctx.drawVector(e.x,e.y,-o.x*t,-o.y*t,5,4,this.style.colVec2),this.ctx.drawCross(e.x,e.y,2,5,this.style.colCenterOfEarth)}renderSurfacePoints(){let t=this.accMultiplier,i=this.mapToScreen(this.vecCenterOfMass,this.scaleSize),e=this.mapToScreen(this.earth.pos,this.scaleSize),h=new s(0,this.earth.r*this.scaleSize),o=this.earth.tidalForce[0].clone().length()*t,a=new s(0,0);for(let t=0;t<360;t+=120){let l=h.rotateEx(t),r=s.addEx(e,l),n=s.addEx(i,l.clone());this.ctx.drawCircle(n,this.distCenterOfMass*this.scaleSize,0,2*Math.PI,null,this.style.colVec1),this.ctx.drawCircle(r,3,0,2*Math.PI,this.style.colVec1,this.style.colVec1),a=s.subtractEx(r,n),a.normalize(),a.multiplyValue(o),this.ctx.drawVector(r.x,r.y,a.x,a.y,5,2,this.style.colVec1,this.style.colVec1)}let l=this.mapToScreen(this.earth.pos,this.scaleSize);this.ctx.drawVector(l.x,l.y,a.x,a.y,5,2,this.style.colOrbit,"white")}renderOverlays(){let t=this.mapToScreen(this.vecCenterOfMass,this.scaleSize);this.ctx.drawCenterOfMass(t,4),this.config.showSurfacePoints&&this.renderSurfacePoints()}renderUnderlay(){if(this.config.showEarthOrbit||this.config.showMoonOrbit){if(this.config.showEarthOrbit){let t=this.mapToScreen(this.vecCenterOfMass,this.scaleSize);this.ctx.drawCircle(t,this.distCenterOfMass*this.scaleSize,0,2*Math.PI,null,this.style.colOrbit)}if(this.config.showMoonOrbit){let t=this.mapToScreen(this.vecCenterOfMass,this.scaleDist);this.ctx.drawCircle(t,(this.distMoonEarth-this.distCenterOfMass)*this.scaleDist,0,2*Math.PI,null,this.style.colOrbit)}}}render(){this.config.showBackgroundImage?this.addBackground():(this.ctx.fillStyle=this.style.colBack,this.ctx.fillRect(0,0,this.w,this.h)),this.config.showSun&&this.renderSun(),this.renderUnderlay(),this.renderEarth(),this.config.showMoon&&this.renderMoon(),this.renderOverlays()}}var o=null;function a(t){if(null==document.getElementById(t.cvid))throw Error("createTidalSimulation: There is no canvas object with such an id!");return new h(t)}return i})()));
//# sourceMappingURL=tides-bundle.js.map